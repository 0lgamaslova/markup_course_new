# Сборщики

## Gulp



**Gulp** – это инструмент, который помогает автоматизировать рутинные задачи веб-разработки. Gulp предназначен для решения таких задач, как:

* Создание веб-сервера и автоматическая перезагрузка страницы в браузере при сохранении кода, слежение за изменениями в файлах проекта;
* Использование различных JavaScript, CSS и HTML препроцессоров \(CoffeeScript, Less, Sass, Stylus, Jade и т.д.\);
* Минификация CSS и JS кода, а также, оптимизация и конкатенация отдельных файлов проекта в один;
* Автоматическое создание вендорных префиксов \(приставок к названию CSS свойства, которые добавляют производители браузеров для нестандартных свойств\) для CSS.
* Управление файлами и папками в рамках проекта – создание, удаление, переименование;
* Запуск и контроль выполнения внешних команд операционной системы;
* Работа с изображениями – сжатие, создание спрайтов, ресайз \(png, jpg, svg и др.\);
* Деплой \(отправка на внешний сервер\) проекта по FTP, SFTP, Git и т.д.
* Подключение и использование в проекте безгранично большого количества Node.js и Gulp утилит, программ и плагинов.
* Создание различных карт проекта и автоматизация другого ручного труда.

Любой проект, использующий Gulp имеет в корне файл **`gulpfile.js`**`,` который содержит набор инструкций по управлению проектом. 

Сразу хочется сказать, что написание инструкций для Gulp не является программированием, хотя пишутся на языке JavaScript. Не стоит пугаться больших `gulpfile.js`, в основном все инструкции однотипные и имеют общие черты. К тому времени, как вы прочтете данное руководство, у вас не должно остаться вопросов по Gulp, так как система сборки элементарная. 

### Установка Gulp

Для работы с Gulp у вас должен быть установлен [Node.js](https://nodejs.org/). Установка Node.js для различных платформ довольно простая – скачиваете инсталлер Node для своей операционной системы и устанавливаете.

![](../.gitbook/assets/image%20%281%29.png)

После того, как `Node` установлен, можно приступать к установке `Gulp`. 

Откройте терминал \(Командная строка в Windows\) или используйте [git bash](https://gitforwindows.org/) и выполните следующую команду:

```javascript
npm i gulp -g
```

Для пользователей Mac и Linux, возможно, придется выполнять команды с правами суперпользователя, **sudo** 

Из данной команды мы видим, что запускается менеджер пакетов [**npm**](https://www.npmjs.com/) \(Node Package Manager\), который командой `install` устанавливает Gulp в систему. 

Ключ **`-g`** говорит о том, что пакет установится в систему глобально, то-есть в систему, а не в папку проекта. Без ключа -g пакет устанавливаются в ту папку, в которой выполняются текущие команды, поэтому будьте внимательны.

### Создание проекта Gulp

Давайте создадим папку проекта для примера, с которой будем работать, пусть это будет, например, папка **myproject** \(не используйте в названии папки и латиницу\).

Теперь откроем терминал в папке проекта. Это можно сделать через вашу IDE. Или же как вариант - для пользователей Windows достаточно зажать Shift и открыть контекстное меню. В нем появится пункт _“Открыть окно команд”:_

![](../.gitbook/assets/image%20%282%29.png)

Далее выполним инициализацию проекта в той папке, которую создали:

```javascript
npm init
```

Следуя инструкциям, заполните метаинформацию о нашем проекте или же можете оставить данные по умолчанию, позже можно будет заменить дефолтные данные на необходимые вам.

В результате такой несложной первоначальной настройки нашего нового Gulp проекта в папке `myproject` нарисуется новый файл **`package.json`**`.`

Файл package.json является файлом манифеста нашего проекта, который описывает помимо той информации, что мы внесли в терминале, еще и информацию об используемых пакетах в нашем проекте.

Например, если мы установим в проект Gulp с ключом **`–save-dev`** , то пакет и используемая версия автоматически добавится в наш package.json. Такой учет позволит быстро разворачивать новый проект с использованием уже имеющегося package.json и устанавливать необходимые модули с зависимостями, которые прописаны в package.json в новых проектах.

**Давайте установим в наш проект Gulp:**

```javascript
npm i gulp --save-dev
```

Что мы видим из данной строки: 

* `npm` устанавливает пакет `gulp` в текущую папку `myproject` \(потому, что нет ключа 
* `i`  - это сокращение от `install`
* `--save-dev` вносит в уже существующий файл `package.json` запись о Gulp в секцию devDependencies.

![](../.gitbook/assets/image%20%283%29.png)

Кроме того, у нас появляется папка**`node_modules`**, которая теперь содержит установленный пакет `gulp` и необходимые зависимости. В данную папку автоматически будут сваливаться все модули и зависимости, которые мы будем устанавливать в проект. Папок с зависимостями может быть очень много, не смотря на то, что мы установили не так уж и много пакетов. Это связано с тем, что в дополнение к основным пакетам устанавливаются программы, необходимые для корректной работы основного пакета. Ни чего чистить и удалять из папки `node_modules` не нужно.

### Плагины Gulp

* [Gulp Sass](http://www.creative-seo.ru/blog/gulp-sass/) — использование препроцессора Sass
* [Gulp Jade](http://www.creative-seo.ru/blog/gulp-jade/) — шаблонизатор Jade
* [UnCSS](http://www.creative-seo.ru/blog/uncss/) — удаление неиспользуемого CSS
* [gulp-watch](http://www.creative-seo.ru/blog/gulp-watch/) — мониторинг изменений
* [Gulp autoprefixer](http://www.creative-seo.ru/blog/gulp-autoprefixer/) — автоматическая проставновка браузерных префиксов

### Общепринятая структура каталогов в проектах

Работая с различными плагинами, программами и скриптами, будь то jQuery плагин, модуль для CMS, веб-проект или какое-то другое ПО, вы наверняка замечали, что у всех проектов есть общая структура каталогов, например, большинство проектов имеет папку **dist** и **app**. 

Давайте создадим первоначальную структуру нашего учебного проекта по всем правилам хорошего тона веб-разработки. В результате мы должны создать следующую структуру в нашем проекте myproject \(все файлы, которых не было, пока создаем пустыми\).

Здесь мы видим папку **app/**, в которой будут размещены все исходные материалы проекта – оригинальные CSS, Sass, js файлы библиотек, оригинальные изображения. В общем – это папка исходников нашего проекта.

Папка **dist/** будет содержать уже готовый продукт, оптимизированный, сжатый, причесанный. Это папка продакшена.

### gulpfile.js

Давайте теперь разберем "внутренности" самого простого \(как раз для начала\) gulpfile.js



```javascript
var gulp = require('gulp');
```

### 

### Настройка 

```javascript
global.$ = {
	// Подключаем Gulp
	gulp: require('gulp'),
	
	gp: require('gulp-load-plugins')(),
	
	// Подключаем Browser Sync
	browserSync: require('browser-sync').create(),
	
	//Указываем путь к gulp-таскам
	path: {
		tasks: require('./gulp/config/tasks.js')
	}
};
```

Создаем **таск SCSS**:

```javascript
module.exports = function() {
	$.gulp.task('sass', function () {
	
		// Берем все sass файлы из папки sass и дочерних, если таковые будут
		return $.gulp.src('src/scss/all.scss')
		
		// инициализируем создание Source Maps
		.pipe($.gp.sourcemaps.init()) 
		
		// Преобразуем Sass в CSS посредством gulp-sass
		.pipe($.gp.sass({}))
		.pipe($.gp.autoprefixer({
			overrideBrowserslist:['last 4 versions'],
			cascade: false
		}))
		.on("error", $.gp.notify.onError({  
			message: "Error: <%= error.message %>",
			title: "Error running sass"
		}))
		
		// CSS минификатор
		.pipe($.gp.csso())   
		
		          
		.pipe($.gp.sourcemaps.write()) 
		
		// Выгружаем результата в папку app/css
		.pipe($.gulp.dest('src/css/'))
		
		// Обновляем CSS на странице при изменении
		.pipe($.browserSync.reload({
			stream: true
		}));
	});
}
```

Создаем **таск browser-sync:**

```javascript
module.exports = function() {
	$.gulp.task('browser-sync', function() {
		$.browserSync.init({
			server: {
				baseDir: "./src"     // Директория для сервера - src
			}
		});
	});
}
```

```javascript
module.exports = function() {
	$.gulp.task('watch', function () {
		$.gulp.watch('src/scss/**/*.scss', $.gulp.series('sass'));
	});
}
```

Создаем таск 

* **task\(\)** – это задачи, которые будет выполнять **gulp**.
* **src\(\)** – команда, позволяющая выбрать нужные файлы из указанных.
* **dest\(\)** – выгружает работу плагинов, подключенных через **pipe\(\)**.
* **gulp.src** – выборка исходных файлов проекта для обработки плагином;
* **.pipe\(plugin\(\)\)** – вызов Gulp плагина для обработки файла;
* **.pipe\(gulp.dest\(‘folder’\)\)** – вывод результирующего файла в папку назначения \(dest – пункт назначения\).

